(function(){
var f=void 0,i=!0,j=null,k=!1,l,aa=this;
function ba(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function n(a){return"array"==ba(a)}Math.floor(2147483648*Math.random()).toString(36);function da(a,b,c){return a.call.apply(a.bind,arguments)}function ea(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}
function fa(a,b,c){fa=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?da:ea;return fa.apply(j,arguments)}function p(a,b){var c=a.split("."),d=aa;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&b!==f?d[e]=b:d=d[e]?d[e]:d[e]={}}function q(a,b){function c(){}c.prototype=b.prototype;a.hd=b.prototype;a.prototype=new c;a.prototype.constructor=a};aa.rethinkdb=function(a){return ga(a)};function r(a){return a instanceof s?a:v(a)}function w(a){return a instanceof ha?a:ia(a)}function x(a,b){if(a){var c=b;n(b)||(c=[c]);if(!c.some(function(b){return"string"===typeof b?typeof a===b:a instanceof b})){if(n(b))throw new TypeError("Function argument "+a+" must be one of the types "+b);throw new TypeError("Function argument "+a+" must be of the type "+b);}}}
function y(a,b){if(a.length<b)throw new TypeError("Function requires at least "+b+" argument"+(1<b?"s.":"."));}function z(a){function b(a){return A.prototype.ja.call(b,a)}var c=arguments[0],d=Array.prototype.slice.call(arguments,1);b.__proto__=c.prototype;c.apply(b,d);return b};function v(a){if(!(a instanceof A))if(a===j||"number"==typeof a)a=z(ja,a);else if("boolean"==typeof a)a=z(ka,a);else if("string"==typeof a)a=z(la,a);else if(n(a))a=z(ma,a);else var b=typeof a,a="object"==b&&a!=j||"function"==b?z(na,a):z(oa,a);return a}p("rethinkdb.expr",v);p("rethinkdb.js",function(a){y(arguments,1);x(a,"string");return z(pa,a)});p("rethinkdb.table",function(a,b){y(arguments,1);x(a,"string");x(b,"boolean");return z(C,a,j,b)});
p("rethinkdb.union",function(a){y(arguments,2);var b=r(arguments[0]);return A.prototype.Oa.apply(b,Array.prototype.slice.call(arguments,1))});function s(){}s.prototype.T=function(a,b){var c=b||qa;if(!c)throw new D("No connection specified and no last connection to default to.");return c.T(this,a)};s.prototype.run=s.prototype.T;s.prototype.rb=function(a){(a?a.T(this):this.T(f)).ra(function(a){1===a.length&&(a=a[0]);console.log(a)})};s.prototype.runp=s.prototype.rb;s.prototype.a=function(){return"----"};
function ra(){}q(ra,s);ra.prototype.o=function(a){var b=new sa,a=this.compile(a);b.na(a);a=new E;a.c(ta);F(a,3,b);return a};function ua(a){Error.captureStackTrace?Error.captureStackTrace(this,ua):this.stack=Error().stack||"";a&&(this.message=String(a))}q(ua,Error);ua.prototype.name="CustomError";function va(a,b,c){this.ed=a;this.s=b;this.v=c.name;this.Y=!!c.D;this.dd=!!c.required;this.p=c.b;this.Ha=c.type;this.Ya=k;switch(this.p){case wa:case xa:case ya:case za:case Aa:this.Ya=i}this.ua=c.defaultValue}var wa=3,xa=4,ya=6,za=16,Aa=18;var Ba=Array.prototype;function Ca(a,b){return a>b?1:a<b?-1:0};function Da(a,b,c){this.hb=a;this.v=b.name||j;this.cd=b.e||j;this.ad=b.l;this.H={};for(a=0;a<c.length;a++)b=c[a],this.H[b.s]=b}function Ea(a){var a=a.H,b=[],c=0,d;for(d in a)b[c++]=a[d];Ba.sort.call(b,function(a,b){return a.s-b.s}||Ca);return b};function G(){this.C={};this.Q=this.constructor.Q;this.H=this.Q.H;this.L=this.Ga=j}l=G.prototype;l.ka=function(){return this.Q};l.get=function(a,b){return H(this,a.s,b)};l.set=function(a,b){F(this,a.s,b)};l.add=function(a,b){I(this,a.s,b)};
l.n=function(a){if(!a||this.constructor!=a.constructor)return k;for(var b=Ea(this.ka()),c=0;c<b.length;c++){var d=b[c];if(Fa(this,d.s)!=Fa(a,d.s))return k;if(Fa(this,d.s)){var e=11==d.p||10==d.p,g=Ga(this,d),h=Ga(a,d);if(d.Y){if(g.length!=h.length)return k;for(d=0;d<g.length;d++)if(!(e?g[d].n(h[d]):g[d]==h[d]))return k}else if(!(e?g.n(h):g==h))return k}}return i};function Fa(a,b){return b in a.C&&a.C[b]!==f&&a.C[b]!==j}
function Ga(a,b){var c=b.s;if(!c in a.C)return j;var d=a.C[c];return d==j?j:a.Ga?!(c in a.L)?(d=a.Ga.bd(a,b,d),a.L[c]=d):a.L[c]:d}function H(a,b,c){b=a.H[b];a=Ga(a,b);if(b.Y)return n(a),a[c||0];n(a);return a}function Ha(a,b){var c;if(Fa(a,b))c=H(a,b,f);else{c=a.H[b];if(c.ua===f){var d=c.Ha;c.ua=d===Boolean?k:d===Number?0:d===String?"":new d}c=c.ua}return c}function Ia(a,b){var c=Ga(a,a.H[b]);c==j||n(c);return c||[]}
function Ja(a,b){return a.H[b].Y?(Fa(a,b)&&n(a.C[b]),Fa(a,b)?a.C[b].length:0):Fa(a,b)?1:0}function F(a,b,c){a.C[b]=c;a.L&&(a.L[b]=c)}function I(a,b,c){a.C[b]||(a.C[b]=[]);a.C[b].push(c);a.L&&delete a.L[b]}function J(a,b){var c=[],d,e;for(e in b)b.hasOwnProperty(e)&&(0==e?d=b[0]:c.push(new va(a,e,b[e])));a.Q=new Da(a,d,c);a.ka=function(){return a.Q}};function K(){G.apply(this)}q(K,G);K.prototype.ba=function(a){F(this,1,a)};function Ka(){G.apply(this)}q(Ka,G);Ka.prototype.U=function(a){F(this,1,a)};Ka.prototype.na=function(a){F(this,2,a)};function L(){G.apply(this)}q(L,G);L.prototype.c=function(a){F(this,1,a)};L.prototype.U=function(a){F(this,2,a)};function La(a){return Ha(a,15)}function Ma(){G.apply(this)}q(Ma,G);function Na(){G.apply(this)}q(Na,G);function Oa(){G.apply(this)}q(Oa,G);function Pa(){G.apply(this)}q(Pa,G);
Pa.prototype.A=function(){return Ha(this,1)};Pa.prototype.r=function(a){F(this,1,a)};Pa.prototype.I=function(a){F(this,2,a)};Pa.prototype.N=function(a){F(this,3,a)};function Qa(){G.apply(this)}q(Qa,G);Qa.prototype.A=function(){return Ha(this,1)};Qa.prototype.r=function(a){F(this,1,a)};function M(){G.apply(this)}q(M,G);M.prototype.c=function(a){F(this,1,a)};M.prototype.ja=function(){return H(this,2)};M.prototype.aa=function(a){F(this,2,a)};
var Ra=19,Sa={yc:1,Yb:2,dc:3,bc:4,ec:5,Dc:6,fc:7,sc:8,Eb:9,Lc:11,Ab:14,Pc:15,vc:16,Qb:17,uc:18,Jb:Ra,Vb:20,rc:21,Kb:22,Cc:23,Pb:24,mc:26,Vc:27,zc:28,Nc:29,Fb:30,Jc:31,$b:32,Cb:35,Bb:36,Hc:37,hc:38,Yc:39};function Ta(){G.apply(this)}q(Ta,G);function Ua(){G.apply(this)}q(Ua,G);Ua.prototype.B=function(a){F(this,1,a)};function Va(){G.apply(this)}q(Va,G);Va.prototype.B=function(a){F(this,1,a)};function Wa(){G.apply(this)}q(Wa,G);Wa.prototype.ja=function(){return H(this,1)};
Wa.prototype.aa=function(a){F(this,1,a)};function Xa(){G.apply(this)}q(Xa,G);function Ya(){G.apply(this)}q(Ya,G);Ya.prototype.I=function(a){F(this,1,a)};function Za(){G.apply(this)}q(Za,G);Za.prototype.q=function(a){F(this,4,a)};function N(){G.apply(this)}q(N,G);N.prototype.F=function(a){F(this,1,a)};N.prototype.q=function(a){F(this,2,a)};function $a(){G.apply(this)}q($a,G);$a.prototype.F=function(a){F(this,1,a)};$a.prototype.q=function(a){F(this,2,a)};function sa(){G.apply(this)}q(sa,G);
sa.prototype.na=function(a){F(this,1,a)};function O(){G.apply(this)}q(O,G);O.prototype.c=function(a){F(this,1,a)};function ab(){G.apply(this)}q(ab,G);ab.prototype.ca=function(a){F(this,1,a)};ab.prototype.B=function(a){F(this,2,a)};function bb(){G.apply(this)}q(bb,G);bb.prototype.ca=function(a){F(this,1,a)};function cb(){G.apply(this)}q(cb,G);cb.prototype.ca=function(a){F(this,1,a)};cb.prototype.B=function(a){F(this,2,a)};function db(){G.apply(this)}q(db,G);
db.prototype.A=function(){return Ha(this,1)};db.prototype.r=function(a){F(this,1,a)};function eb(){G.apply(this)}q(eb,G);eb.prototype.U=function(a){F(this,2,a)};function fb(){G.apply(this)}q(fb,G);l=fb.prototype;l.A=function(){return Ha(this,1)};l.r=function(a){F(this,1,a)};l.I=function(a){F(this,2,a)};l.N=function(a){F(this,3,a)};l.B=function(a){F(this,4,a)};function gb(){G.apply(this)}q(gb,G);gb.prototype.A=function(){return Ha(this,1)};gb.prototype.r=function(a){F(this,1,a)};
gb.prototype.I=function(a){F(this,2,a)};gb.prototype.N=function(a){F(this,3,a)};function hb(){G.apply(this)}q(hb,G);l=hb.prototype;l.A=function(){return Ha(this,1)};l.r=function(a){F(this,1,a)};l.I=function(a){F(this,2,a)};l.N=function(a){F(this,3,a)};l.B=function(a){F(this,4,a)};function ib(){G.apply(this)}q(ib,G);ib.prototype.c=function(a){F(this,1,a)};ib.prototype.ba=function(a){F(this,2,a)};function jb(){G.apply(this)}q(jb,G);jb.prototype.A=function(){return Ha(this,3)};
jb.prototype.r=function(a){F(this,3,a)};function E(){G.apply(this)}q(E,G);E.prototype.c=function(a){F(this,1,a)};E.prototype.M=function(){return H(this,2)};E.prototype.ya=function(a){F(this,2,a)};var ta=1,kb={Ic:ta,Zc:2,Lb:3,Mc:4,tc:5};function lb(){G.apply(this)}q(lb,G);lb.prototype.M=function(){return H(this,2)};lb.prototype.ya=function(a){F(this,2,a)};function mb(){G.apply(this)}q(mb,G);
J(K,{"0":{name:"TableRef",e:"TableRef"},1:{name:"db_name",b:9,type:String},2:{name:"table_name",b:9,type:String},3:{name:"use_outdated",b:8,defaultValue:0,type:Boolean}});J(Ka,{"0":{name:"VarTermTuple",e:"VarTermTuple"},1:{name:"var",b:9,type:String},2:{name:"term",b:11,type:L}});
J(L,{"0":{name:"Term",e:"Term"},1:{name:"type",b:14,defaultValue:0,type:{kc:0,Xc:1,nc:2,Ib:3,cc:4,Ub:5,Ac:6,Oc:7,JSON:8,BOOL:9,Db:10,Bc:11,Zb:12,Uc:13,jc:14,gc:15}},2:{name:"var",b:9,type:String},3:{name:"let",b:11,type:Ma},4:{name:"call",b:11,type:Na},5:{name:"if_",b:11,type:Oa},6:{name:"error",b:9,type:String},7:{name:"number",b:1,type:Number},8:{name:"valuestring",b:9,type:String},9:{name:"jsonstring",b:9,type:String},10:{name:"valuebool",b:8,type:Boolean},11:{name:"array",D:i,b:11,type:L},12:{name:"object",
D:i,b:11,type:Ka},14:{name:"get_by_key",b:11,type:Pa},15:{name:"table",b:11,type:Qa},16:{name:"javascript",b:9,type:String}});J(Ma,{"0":{name:"Let",l:L,e:"Term.Let"},1:{name:"binds",D:i,b:11,type:Ka},2:{name:"expr",b:11,type:L}});J(Na,{"0":{name:"Call",l:L,e:"Term.Call"},1:{name:"builtin",b:11,type:M},2:{name:"args",D:i,b:11,type:L}});J(Oa,{"0":{name:"If",l:L,e:"Term.If"},1:{name:"test",b:11,type:L},2:{name:"true_branch",b:11,type:L},3:{name:"false_branch",b:11,type:L}});
J(Pa,{"0":{name:"GetByKey",l:L,e:"Term.GetByKey"},1:{name:"table_ref",b:11,type:K},2:{name:"attrname",b:9,type:String},3:{name:"key",b:11,type:L}});J(Qa,{"0":{name:"Table",l:L,e:"Term.Table"},1:{name:"table_ref",b:11,type:K}});
J(M,{"0":{name:"Builtin",e:"Builtin"},1:{name:"type",b:14,defaultValue:1,type:Sa},2:{name:"attr",b:9,type:String},3:{name:"attrs",D:i,b:9,type:String},4:{name:"comparison",b:14,defaultValue:1,type:{Tb:1,xc:2,qc:3,lc:4,ac:5,Xb:6}},5:{name:"filter",b:11,type:Ta},6:{name:"map",b:11,type:Ua},7:{name:"concat_map",b:11,type:Va},8:{name:"order_by",D:i,b:11,type:Wa},9:{name:"reduce",b:11,type:Za},10:{name:"grouped_map_reduce",b:11,type:Xa},11:{name:"range",b:11,type:Ya}});
J(Ta,{"0":{name:"Filter",l:M,e:"Builtin.Filter"},1:{name:"predicate",b:11,type:$a}});J(Ua,{"0":{name:"Map",l:M,e:"Builtin.Map"},1:{name:"mapping",b:11,type:N}});J(Va,{"0":{name:"ConcatMap",l:M,e:"Builtin.ConcatMap"},1:{name:"mapping",b:11,type:N}});J(Wa,{"0":{name:"OrderBy",l:M,e:"Builtin.OrderBy"},1:{name:"attr",b:9,type:String},2:{name:"ascending",b:8,defaultValue:1,type:Boolean}});
J(Xa,{"0":{name:"GroupedMapReduce",l:M,e:"Builtin.GroupedMapReduce"},1:{name:"group_mapping",b:11,type:N},2:{name:"value_mapping",b:11,type:N},3:{name:"reduction",b:11,type:Za}});J(Ya,{"0":{name:"Range",l:M,e:"Builtin.Range"},1:{name:"attrname",b:9,type:String},2:{name:"lowerbound",b:11,type:L},3:{name:"upperbound",b:11,type:L}});J(Za,{"0":{name:"Reduction",e:"Reduction"},1:{name:"base",b:11,type:L},2:{name:"var1",b:9,type:String},3:{name:"var2",b:9,type:String},4:{name:"body",b:11,type:L}});
J(N,{"0":{name:"Mapping",e:"Mapping"},1:{name:"arg",b:9,type:String},2:{name:"body",b:11,type:L}});J($a,{"0":{name:"Predicate",e:"Predicate"},1:{name:"arg",b:9,type:String},2:{name:"body",b:11,type:L}});J(sa,{"0":{name:"ReadQuery",e:"ReadQuery"},1:{name:"term",b:11,type:L},2:{name:"max_chunk_size",b:3,type:String},3:{name:"max_age",b:3,type:String}});
J(O,{"0":{name:"WriteQuery",e:"WriteQuery"},1:{name:"type",b:14,defaultValue:1,type:{Wc:1,Ob:2,wc:3,ic:4,Wb:6,Gc:7,Ec:8,Fc:9}},11:{name:"atomic",b:8,defaultValue:1,type:Boolean},2:{name:"update",b:11,type:ab},3:{name:"delete",b:11,type:bb},4:{name:"mutate",b:11,type:cb},5:{name:"insert",b:11,type:db},7:{name:"for_each",b:11,type:eb},8:{name:"point_update",b:11,type:fb},9:{name:"point_delete",b:11,type:gb},10:{name:"point_mutate",b:11,type:hb}});
J(ab,{"0":{name:"Update",l:O,e:"WriteQuery.Update"},1:{name:"view",b:11,type:L},2:{name:"mapping",b:11,type:N}});J(bb,{"0":{name:"Delete",l:O,e:"WriteQuery.Delete"},1:{name:"view",b:11,type:L}});J(cb,{"0":{name:"Mutate",l:O,e:"WriteQuery.Mutate"},1:{name:"view",b:11,type:L},2:{name:"mapping",b:11,type:N}});J(db,{"0":{name:"Insert",l:O,e:"WriteQuery.Insert"},1:{name:"table_ref",b:11,type:K},2:{name:"terms",D:i,b:11,type:L},3:{name:"overwrite",b:8,defaultValue:0,type:Boolean}});
J(eb,{"0":{name:"ForEach",l:O,e:"WriteQuery.ForEach"},1:{name:"stream",b:11,type:L},2:{name:"var",b:9,type:String},3:{name:"queries",D:i,b:11,type:O}});J(fb,{"0":{name:"PointUpdate",l:O,e:"WriteQuery.PointUpdate"},1:{name:"table_ref",b:11,type:K},2:{name:"attrname",b:9,type:String},3:{name:"key",b:11,type:L},4:{name:"mapping",b:11,type:N}});J(gb,{"0":{name:"PointDelete",l:O,e:"WriteQuery.PointDelete"},1:{name:"table_ref",b:11,type:K},2:{name:"attrname",b:9,type:String},3:{name:"key",b:11,type:L}});
J(hb,{"0":{name:"PointMutate",l:O,e:"WriteQuery.PointMutate"},1:{name:"table_ref",b:11,type:K},2:{name:"attrname",b:9,type:String},3:{name:"key",b:11,type:L},4:{name:"mapping",b:11,type:N}});J(ib,{"0":{name:"MetaQuery",e:"MetaQuery"},1:{name:"type",b:14,defaultValue:1,type:{Mb:1,Rb:2,oc:3,Nb:4,Sb:5,pc:6}},2:{name:"db_name",b:9,type:String},3:{name:"create_table",b:11,type:jb},4:{name:"drop_table",b:11,type:K}});
J(jb,{"0":{name:"CreateTable",l:ib,e:"MetaQuery.CreateTable"},1:{name:"datacenter",b:9,type:String},3:{name:"table_ref",b:11,type:K},4:{name:"primary_key",b:9,defaultValue:"id",type:String},5:{name:"cache_size",b:3,defaultValue:"1073741824",type:String}});J(E,{"0":{name:"Query",e:"Query"},1:{name:"type",b:14,defaultValue:ta,type:kb},2:{name:"token",b:3,type:String},3:{name:"read_query",b:11,type:sa},4:{name:"write_query",b:11,type:O},5:{name:"meta_query",b:11,type:ib}});
J(lb,{"0":{name:"Response",e:"Response"},1:{name:"status_code",b:14,defaultValue:0,type:{Qc:0,Rc:1,Sc:2,Tc:3,Hb:101,Gb:102,Kc:103}},2:{name:"token",b:3,type:String},3:{name:"response",D:i,b:9,type:String},4:{name:"error_message",b:9,type:String},5:{name:"backtrace",b:11,type:mb}});J(mb,{"0":{name:"Backtrace",l:lb,e:"Response.Backtrace"},1:{name:"frame",D:i,b:9,type:String}});function A(){}q(A,ra);function nb(a){this.ib=a||""}q(nb,A);nb.prototype.compile=function(){var a=new L;a.c(5);F(a,6,this.ib);return a};nb.prototype.a=function(a){return a?"^^^^^^^^^":"r.error()"};p("rethinkdb.error",function(){return new nb});function oa(a){this.i=a}q(oa,A);oa.prototype.compile=function(){var a=new L;a.c(8);var b=JSON.stringify(this.i);F(a,9,b);return a};function ja(a){this.i="undefined"===typeof a?j:a}q(ja,A);
ja.prototype.compile=function(){var a=new L;this.i===j?a.c(0):(a.c(6),F(a,7,this.i));return a};ja.prototype.a=function(a){var b="r.expr("+this.i+")";return a?P(b):b};function ka(a){this.i=a}q(ka,A);ka.prototype.compile=function(){var a=new L;a.c(9);F(a,10,this.i);return a};ka.prototype.a=function(a){var b="r.expr("+this.i+")";return a?P(b):b};function la(a){this.i=a}q(la,A);la.prototype.compile=function(){var a=new L;a.c(7);F(a,8,this.i);return a};
la.prototype.a=function(a){var b="r.expr('"+this.i+"')";return a?P(b):b};function ma(a){this.i=[];for(var b=0;b<a.length;b++){var c=r(a[b]);this.i.push(c)}}q(ma,A);ma.prototype.compile=function(a){var b=new L;b.c(10);for(var c=0;c<this.i.length;c++){var d=this.i[c].compile(a);I(b,11,d)}return b};
ma.prototype.a=function(a){var b=this.i.map(function(a){return a.a()});if(a){if(0===a.length)return P("r.expr(["+b.join(", ")+"])");var c=a[0].split(":");a.shift();c=parseInt(c[1],10);b=b.map(Q);b[c]=this.i[c].a(a);return"        "+b.join("  ")+"  "}return"r.expr(["+b.join(", ")+"])"};function na(a){this.i={};for(var b in a)if(a.hasOwnProperty(b)){var c=r(a[b]);this.i[b]=c}}q(na,A);
na.prototype.compile=function(a){var b=new L;b.c(11);for(var c in this.i)if(this.i.hasOwnProperty(c)){var d=new Ka;d.U(c);d.na(this.i[c].compile(a));I(b,12,d)}return b};
na.prototype.a=function(a){var b=[],c;for(c in this.i)this.i.hasOwnProperty(c)&&b.push("'"+c+"':"+this.i[c].a());b="r.expr({"+b.join(", ")+"})";if(a){if(0===a.length)return P(b);b=a[0].split(":");a.shift();var d=b[1],b=[];for(c in this.i)this.i.hasOwnProperty(c)&&(c===d?b.push(Q("'"+c+"':")+this.i[c].a(a)):b.push(Q("'"+c+"':"+this.i[c].a())));return"        "+b.join("  ")+"  "}return b};function pa(a){this.La=a}q(pa,A);pa.prototype.compile=function(){var a=new L;a.c(14);F(a,16,this.La);return a};
pa.prototype.a=function(a){var b="r.js('"+this.La+"')";return a?P(b):b};function ha(a,b){1>a.length&&a.push("");this.m=a;this.body=b}ha.prototype.a=function(a){return a?Q("function("+this.m.join(", ")+") {return ")+this.body.a(a)+" ":"function("+this.m.join(", ")+") {return "+this.body.a()+"}"};var ob=0;
function ia(a){var b,c;if("function"===typeof a&&!(a instanceof s)){b=[];for(c=0;c<a.length;c++)b.push("arg"+b.length+"_"+ob++);c=a.apply(j,b.map(function(a){return pb(a)}));if(!(c instanceof s))throw new D("ReQL function must return ReQL expression");}else c=arguments[arguments.length-1],b=Array.prototype.slice.call(arguments,0,arguments.length-1);c=r(c);b.forEach(function(a){return x(a,"string")});return z(ha,b,c)}p("rethinkdb.fn",ia);
function R(a,b,c,d){this.Wa=a;this.Ca=b;this.Aa=d||j;this.a=c}q(R,A);R.prototype.compile=function(a){var b=new M;b.c(this.Wa);this.Aa&&this.Aa(b);var c=new Na;F(c,1,b);for(var d in this.Ca)b=this.Ca[d].compile(a),I(c,2,b);a=new L;a.c(3);F(a,4,c);return a};function qb(a,b){A.prototype[b]=function(c){y(arguments,1);c=r(c);return z(R,a,[this,c],rb(b,this,c))}}function sb(a,b){A.prototype[b]=function(c){y(arguments,1);c=r(c);return z(R,Ra,[this,c],rb(b,this,c),function(b){F(b,4,a)})}}qb(14,"add");
qb(15,"sub");qb(16,"mul");qb(17,"div");qb(18,"mod");sb(1,"eq");sb(2,"ne");sb(3,"lt");sb(4,"le");sb(5,"gt");sb(6,"ge");A.prototype.xa=function(){return z(R,1,[this],rb("not",this))};A.prototype.not=A.prototype.xa;A.prototype.count=function(){return z(R,26,[this],rb("count",this))};A.prototype.count=A.prototype.count;A.prototype.Ba=function(a){y(arguments,1);a=r(a);return z(R,36,[this,a],rb("and",this,a))};A.prototype.and=A.prototype.Ba;
A.prototype.Ia=function(a){y(arguments,1);a=r(a);return z(R,35,[this,a],rb("or",this,a))};A.prototype.or=A.prototype.Ia;A.prototype.Va=function(a,b,c){y(arguments,2);a=r(a);b=r(b);x(c,"string");var d=c?c:"id";return z(R,37,[this],rb("between",this,a,b,"'"+d+"'"),function(c,g){var h=new Ya;h.I(d);var m=a.compile(g);F(h,2,m);m=b.compile(g);F(h,3,m);F(c,11,h)})};A.prototype.between=A.prototype.Va;A.prototype.append=function(a){y(arguments,1);a=r(a);return z(R,9,[this,a],rb("append",this,a))};
A.prototype.append=A.prototype.append;function tb(a,b,c){b=r(b);c=c?r(c):new oa(j);R.call(this,11,[a,b,c],function(d){if(d){var e=d[0].split(":");e[1]=parseInt(e[1],10);d.shift();return 0===e[1]?a.a(d)+Q(".slice("+b.a()+(c?", "+c.a():"")+")"):1===e[1]?Q(a.a()+".slice(")+b.a(d)+Q((c?", "+c.a():"")+")"):Q(a.a()+".slice("+b.a(d)+", ")+c.a(d)+" "}return a.a()+".slice("+b.a()+(c?", "+c.a():"")+")"})}q(tb,R);A.prototype.slice=function(a,b){y(arguments,1);return z(tb,this,a,b)};A.prototype.slice=A.prototype.slice;
A.prototype.gb=function(a){y(arguments,1);return z(tb,this,0,a)};A.prototype.limit=A.prototype.gb;A.prototype.tb=function(a){y(arguments,1);return z(tb,this,a)};A.prototype.skip=A.prototype.tb;A.prototype.lb=function(a){y(arguments,1);a=r(a);return z(R,28,[this,a],rb("nth",this,a))};A.prototype.nth=A.prototype.lb;
A.prototype.filter=function(a){var b;if("object"===typeof a&&!(a instanceof s)){var c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push(ga(d).eq(v(a[d])));b=z(ha,[""],z(R,36,c,function(a){var b=c.map(function(a){return a.a()});if(a){var d=a[0].split(":");a.shift();b=b.map(Q);b[d[1]]=c[d[1]].a(a);return b.join("      ")}return b.join(").and(")}))}else b=w(a);var e=this;return z(R,20,[this],function(a){if(a){if("predicate"===a[0])return a.shift(),Q(e.a()+".filter(")+b.a(a)+" ";a.shift();return e.a(a)+Q(".filter("+
b.a(a)+")")}return e.a()+".filter("+b.a()+")"},function(a,c){var d=new $a;d.F(b.m[0]);d.q(b.body.compile(c));var e=new Ta;F(e,1,d);F(a,5,e)})};A.prototype.filter=A.prototype.filter;A.prototype.map=function(a){var a=w(a),b=this;return z(R,21,[this],function(c){if(c){if("arg:0"===c[0])return c.shift(),b.a(c)+Q(".map("+a.a(c)+")");c.shift();return Q(b.a()+".map(")+a.a(c)+" "}return b.a()+".map("+a.a()+")"},function(b,d){var e=new N;e.F(a.m[0]);e.q(a.body.compile(d));var g=new Ua;g.B(e);F(b,6,g)})};
A.prototype.map=A.prototype.map;
A.prototype.mb=function(a){y(arguments,1);var b=Array.prototype.slice.call(arguments,0);b.forEach(function(a){x(a,"string")});var c=this;return z(R,23,[this],function(a){var e=b.map(function(a){return"'"+a+"'"});return a?"order_by"===a.shift()?Q(c.a()+".orderby(")+P(e.join(", "))+" ":c.a(a)+Q(".orderby("+e.join(", ")+")"):c.a()+".orderby("+e.join(", ")+")"},function(a){for(var c=0;c<b.length;c++){var g=i,h=b[c];"-"===h[0]&&(g=k,h=h.slice(1));var m=new Wa;m.aa(h);F(m,2,g);I(a,8,m)}})};
A.prototype.orderby=A.prototype.mb;A.prototype.Za=function(a){x(a,"string");var b=a?this.map(ga(a)):this;return z(R,24,[b],function(a){return a?(a.shift(),b.a(a)+"           "):b.a()+".distinct()"})};A.prototype.distinct=A.prototype.Za;
A.prototype.reduce=function(a,b){y(arguments,2);var a=r(a),b=w(b),c=this;return z(R,31,[this],function(d){if(d)if("reduce"===d[0]){d.shift();if("body"===d[0])return d.shift(),Q(c.a()+".reduce("+a.a()+", ")+b.a(d)+" ";if("base"===d[0])return d.shift(),Q(c.a()+".reduce(")+a.a(d)+Q(", "+b.a()+")")}else return d.shift(),c.a(d)+Q(".reduce("+a.a()+", "+b.a()+")");else return c.a()+".reduce("+a.a()+", "+b.a()+")"},function(c,e){var g=new Za,h=a.compile(e);F(g,1,h);F(g,2,b.m[0]);F(g,3,b.m[1]);g.q(b.body.compile(e));
F(c,9,g)})};A.prototype.reduce=A.prototype.reduce;
A.prototype.Fa=function(a,b,c,d){y(arguments,4);var a=w(a),b=w(b),c=r(c),d=w(d),e=this;return z(R,32,[this],function(g){var h=e.a(),m=a.a(),u=b.a(),t=c.a(),B=d.a();if(g){var ca=g.shift();if("arg:0"===ca)return e.a(g)+Q(".groupedMapReduce("+m+", "+u+", "+t+", "+B+")");if("group_mapping"===ca)return Q(h+".groupedMapReduce(")+a.a(g)+Q(", "+u+", "+t+", "+B+")");if("value_mapping"===ca)return Q(h+".groupedMapReduce("+m+", ")+b.a(g)+Q(", "+t+", "+B+")");ca=g.shift();return"base"===ca?Q(h+".groupedMapReduce("+
m+", "+u+", ")+c.a(g)+Q(", "+B+")"):Q(h+".groupedMapReduce("+m+", "+u+", "+t+", ")+d.a(g)+" "}return h+".groupedMapReduce("+m+", "+u+", "+t+", "+B+")"},function(e,h){var m=new N;m.F(a.m[0]);m.q(a.body.compile(h));var u=new N;u.F(b.m[0]);u.q(b.body.compile(h));var t=new Za,B=c.compile(h);F(t,1,B);F(t,2,d.m[0]);F(t,3,d.m[1]);t.q(d.body.compile(h));B=new Xa;F(B,1,m);F(B,2,u);F(B,3,t);F(e,10,B)})};A.prototype.groupedMapReduce=A.prototype.Fa;
A.prototype.cb=function(a){y(arguments,2);var b=Array.prototype.slice.call(arguments,0,-1);b.forEach(function(a){x(a,"string")});var c=arguments[arguments.length-1];x(c,"object");var d=ia(function(a){return 1<b.length?v(b.map(a)):a(b[0])}),e=c.mapping||ia(function(a){return a}),g=c.base,h=c.reduction;if(!h)throw new D("Must provide a reduction to groupby");if(g===f)throw new D("Must provide a base for the reduction in groupby");var d=this.Fa(d,e,g,h),m=c.finalizer;m&&(d=d.map(function(a){return a.extend({reduction:m(a("reduction"))})}));
return d};A.prototype.groupBy=A.prototype.cb;p("rethinkdb.count",{mapping:function(){return v(1)},base:0,reduction:function(a,b){return a.add(b)}});p("rethinkdb.sum",function(a){y(arguments,1);x(a,"string");return{mapping:function(b){return b(a)},base:0,reduction:function(a,c){return a.add(c)}}});
p("rethinkdb.average",function(a){y(arguments,1);x(a,"string");return{mapping:function(b){return v([b(a),1])},base:[0,0],reduction:function(a,c){return v([a.nth(0).add(c.nth(0)),a.nth(1).add(c.nth(1))])},finalizer:function(a){return a.nth(0).div(a.nth(1))}}});A.prototype.contains=function(a){x(a,"string");var b=this;return z(R,4,[this],function(c){return c?"arg:0"===c.shift()?b.a(c)+Q(".contains("+a+")"):Q(b.a())+P(".contains("+a+")"):b.a()+".contains("+a+")"},function(b){b.aa(a)})};
A.prototype.contains=A.prototype.contains;A.prototype.ja=function(a){x(a,"string");var b=this;return z(R,2,[this],function(c){return c?"arg:0"===c[0]?(c.shift(),b.a(c)):Q(b.a())+P("('"+a+"')"):b.a()+"('"+a+"')"},function(b){b.aa(a)})};A.prototype.getAttr=A.prototype.ja;
A.prototype.Ja=function(){var a=Array.prototype.slice.call(arguments,0);n(a)||(a=[a]);a.forEach(function(a){x(a,"string")});var b=this;return z(R,6,[this],function(c){var d=a.map(function(a){return"'"+a+"'"});return c?(c.shift(),b.a(c)+Q(".pick("+d.join(", ")+")")):b.a()+".pick("+d.join(", ")+")"},function(b){for(var d in a)I(b,3,a[d])})};A.prototype.pick=A.prototype.Ja;
A.prototype.Pa=function(a){n(a)||(a=[a]);a.forEach(function(a){x(a,"string")});var b=this;return z(R,39,[this],function(c){var d=a.map(function(a){return"'"+a+"'"});return c?(c.shift(),b.a(c)+Q(".unpick("+d.join(", ")+")")):b.a()+".unpick("+d.join(", ")+")"},function(b){for(var d in a)I(b,3,a[d])})};A.prototype.unpick=A.prototype.Pa;A.prototype.ob=function(){var a=Array.prototype.slice.call(arguments,0);return this.map(function(b){return A.prototype.Ja.apply(b,a)})};A.prototype.pluck=A.prototype.ob;
A.prototype.yb=function(){var a=Array.prototype.slice.call(arguments,0);return this.map(function(b){return A.prototype.Pa.apply(b,a)})};A.prototype.without=A.prototype.yb;function ub(a){this.Qa=a}q(ub,A);ub.prototype.compile=function(){var a=new L;a.c(1);a.U(this.Qa);return a};ub.prototype.a=function(a){var b="r.letVar('"+this.Qa+"')";return a?P(b):b};function vb(){}q(vb,A);vb.prototype.compile=function(){var a=new L;a.c(15);return a};vb.prototype.a=function(a){return a?"^^^^^^^^":"r.R('@')"};
function wb(a,b){R.call(this,2,[a],function(c){return c?"arg:0"===c.shift()?a.a(c)+"('"+b+"')":Q(a.a())+P("('"+b+"')"):a.a()+"('"+b+"')"},function(a){a.aa(b)})}q(wb,R);function ga(a){x(a,"string");var a=a.split("."),b=a.shift();"@"===b[0]&&1<b.length?a.unshift(b.slice(1)):"@"!==b[0]&&a.unshift(b);for(var c=z(vb);b=a.shift();)c=z(wb,c,b);return c}p("rethinkdb.R",ga);function pb(a){x(a,"string");for(var a=a.split("."),b=a.shift(),c=z(ub,b);b=a.shift();)c=z(wb,c,b);return c}p("rethinkdb.letVar",pb);
A.prototype.extend=function(a){var a=r(a),b=this;return z(R,8,[this,a],function(c){return c?"arg:0"===c.shift()?b.a(c)+Q(".extend("+a.a()+")"):Q(b.a()+".extend(")+a.a(c)+" ":b.a()+".extend("+a.a()+")"})};A.prototype.extend=A.prototype.extend;
A.prototype.Oa=function(a){y(arguments,1);var b=Array.prototype.slice.call(arguments,0).map(r),c=this;return z(R,27,[this].concat(b),function(a){var e=b.map(function(a){return a.a()});if(a){var g=a.shift();if(g){if("arg:0"===g)return c.a(a)+Q(".union("+e.join(", ")+")");g=parseInt(g.split(":")[1],10);e=e.map(Q);e[g]=b[g].a(a);return Q(c.a()+".union(")+e.join("  ")+" "}return P(c.a()+".union("+e.join(", ")+")")}return c.a()+".union("+e.join(", ")+")"})};A.prototype.union=A.prototype.Oa;
A.prototype.P=function(a){var a=w(a),b=this;return z(R,22,[this],function(c){return c?"arg:0"===c.shift()?b.a(c)+Q(".concatMap("+a.a()+")"):Q(b.a()+".concatMap(")+a.a(c)+" ":b.a()+".concatMap("+a.a()+")"},function(b,d){var e=new N;e.F(a.m[0]);e.q(a.body.compile(d));var g=new Va;g.B(e);F(b,7,g)})};A.prototype.concatMap=A.prototype.P;function xb(a,b,c){this.oa=a;this.pa=b;this.ha=c}q(xb,A);
xb.prototype.compile=function(a){var b=new Oa,c=this.oa.compile(a);F(b,1,c);c=this.pa.compile(a);F(b,2,c);a=this.ha.compile(a);F(b,3,a);a=new L;a.c(4);F(a,5,b);return a};xb.prototype.a=function(a){if(a){var b=a.shift(),c=Q(this.oa.a()),d=Q(this.pa.a()),e=Q(this.ha.a());"test"===b?c=this.oa.a(a):"true"===b?d=this.pa.a(a):e=this.ha.a(a);return"             "+c+"  "+d+"  "+e+" "}return"r.ifThenElse("+this.oa.a()+", "+this.pa.a()+", "+this.ha.a()+")"};
function yb(a,b,c){x(b,s);x(c,s);a=r(a);return z(xb,a,b,c)}p("rethinkdb.ifThenElse",yb);function zb(a,b){this.O=a;this.qa=b}q(zb,A);zb.prototype.compile=function(a){var b=new Ma,c;for(c in this.O)if(this.O.hasOwnProperty(c)){var d=this.O[c],e=new Ka;e.U(c);e.na(d.compile(a));I(b,1,e)}a=this.qa.compile(a);F(b,2,a);a=new L;a.c(2);F(a,3,b);return a};
zb.prototype.a=function(a){var b=[],c;for(c in this.O)this.O.hasOwnProperty(c)&&b.push([c,this.O[c]]);if(a){var d=a.shift().split(":")[1],b=b.map(function(b){return b[0]===d?Q("'"+b[0]+"':")+b[1].a(a):Q("'"+b[0]+"':"+b[1].a())});return Q("r.let({")+b.join("  ")+Q("}, "+this.qa.a()+")")}b=b.map(function(a){return"'"+a[0]+"':"+a[1].a()});return"r.let({"+b.join(", ")+"}, "+this.qa.a()+")"};function Ab(a,b){x(b,s);for(var c in a)a.hasOwnProperty(c)&&x(a[c],A);return z(zb,a,b)}p("rethinkdb.let",Ab);
function Bb(a,b){this.wa=a;this.ia=b}q(Bb,s);Bb.prototype.o=function(a){var b=new eb,c=this.wa.compile(a);F(b,1,c);b.U(this.ia.m[0]);a=this.ia.body.o(a);a=H(a,4);if(!a)throw new D("For each requires a write query to execute");I(b,3,a);a=new O;a.c(6);F(a,7,b);b=new E;b.c(2);F(b,4,a);return b};Bb.prototype.a=function(a){return a?(a.shift(),this.wa.a(a)+Q(".forEach("+this.ia.a()+")")):this.wa.a()+".forEach("+this.ia.a()+")"};A.prototype.forEach=function(a){a=w(a);return z(Bb,this,a)};
A.prototype.forEach=A.prototype.forEach;A.prototype.eb=function(a,b){return this.P(function(c){return a.P(function(a){return yb(b(c,a),v([{left:c,right:a}]),v([]))})})};A.prototype.innerJoin=A.prototype.eb;A.prototype.nb=function(a,b){return this.P(function(c){return Ab({matches:a.P(function(a){return yb(b(c,a),v([{left:c,right:a}]),v([]))}).Ma()},yb(pb("matches").count().gt(0),pb("matches"),v([{left:c}])))})};A.prototype.outerJoin=A.prototype.nb;
A.prototype.ab=function(a,b){return this.P(function(c){return Ab({right:b.get(c(a))},yb(pb("right").ne(v(j)),v([{left:c,right:pb("right")}]),v([])))})};A.prototype.equiJoin=A.prototype.ab;A.prototype.zb=function(){return this.map(function(a){return yb(a.contains("right"),a("left").extend(a("right")),a("left"))})};A.prototype.zip=A.prototype.zb;A.prototype.Ma=function(){var a=this;return z(R,29,[this],function(b){return b?(b.shift(),a.a(b)+"                "):a.a()+".streamToArray()"})};
A.prototype.streamToArray=A.prototype.Ma;A.prototype.Ua=function(){var a=this;return z(R,30,[this],function(b){return b?(b.shift(),a.a(b)+"                "):a.a()+".arrayToStream()"})};A.prototype.arrayToStream=A.prototype.Ua;function C(a,b,c){this.v=a;this.z=b;this.Ta="boolean"===typeof c?c:j}q(C,A);C.prototype.compile=function(a){var b=new L;b.c(13);var c=new Qa,d=new K;d.ba(this.z||qa.z);F(d,2,this.v);F(d,3,this.Ta!==j?this.$c:a&&a.Da!==f?a.Da:k);c.r(d);F(b,15,c);return b};C.prototype.a=function(a){return a?this.z?P("r.db('"+this.z+"').table('"+this.v+"')"):P("r.table('"+this.v+"')"):this.z?"r.db('"+this.z+"').table('"+this.v+"')":"r.table('"+this.v+"')"};function Cb(a,b,c){this.f=a;this.j=b;this.g=c||"id"}q(Cb,A);
Cb.prototype.compile=function(a){var b=this.f.compile(a),c=H(b,15).A(),b=new Pa;b.r(c);b.I(this.g);b.N(this.j.compile(a));a=new L;a.c(12);F(a,14,b);return a};Cb.prototype.a=function(a){if(a){var b=a.shift();return"key"===b?Q(this.f.a()+".get(")+this.j.a(a)+Q(", '"+this.g+"')"):"attrname"===b?Q(this.f.a()+".get("+this.j.a()+", ")+P("'"+this.g+"'")+" ":this.f.a(a)+Q(".get("+this.j.a()+", '"+this.g+"')")}return this.f.a()+".get("+this.j.a()+", '"+this.g+"')"};
C.prototype.get=function(a,b){y(arguments,1);a=r(a);return z(Cb,this,a,b)};C.prototype.get=C.prototype.get;function Db(a,b){this.f=a;this.fa=b}q(Db,s);Db.prototype.o=function(a){var b=this.f.compile(a),c=H(b,15).A(),b=new db;b.r(c);for(c=0;c<this.fa.length;c++){var d=this.fa[c].compile(a);I(b,2,d)}a=new O;a.c(4);F(a,5,b);b=new E;b.c(2);F(b,4,a);return b};
Db.prototype.a=function(a){var b=this.fa.map(function(a){return a.a()});if(a){var b=b.map(Q),c=a.shift(),d;c!==f?(d=Q(this.f.a()),c=parseInt(c.split(":")[1],10),b[c]=this.fa[c].a(a)):d=this.f.a(a);a=" "+b.join("  ")+" ";return d+"        "+a+" "}a="["+b.join(", ")+"]";return this.f.a()+".insert("+a+")"};C.prototype.fb=function(a){y(arguments,1);n(a)||(a=[a]);a=a.map(v);return new Db(this,a)};C.prototype.insert=C.prototype.fb;function Eb(a){this.t=a}q(Eb,s);
Eb.prototype.o=function(a){var b=new bb;b.ca(this.t.compile(a));a=new O;a.c(2);F(a,3,b);b=new E;b.c(2);F(b,4,a);return b};Eb.prototype.a=function(a){return a?(a.shift(),this.t.a(a)+"      "):this.t.a()+".del()"};function Fb(a,b,c){this.f=a;this.j=b;this.g=c||"id"}q(Fb,s);Fb.prototype.o=function(a){var b=new gb;b.r(La(this.f.compile(a)).A());b.I(this.g);b.N(this.j.compile(a));a=new O;a.c(8);F(a,9,b);b=new E;b.c(2);F(b,4,a);return b};
Fb.prototype.a=function(a){return a?a.shift()!==f?Q(this.f.a()+".get(")+this.j.a(a)+"       ":this.f.a(a)+Q(".get("+this.j.a()+").del()"):this.f.a()+".get("+this.j.a()+").del()"};A.prototype.Xa=function(){return this instanceof Cb?new Fb(this.f,this.j,this.g):new Eb(this)};A.prototype.del=A.prototype.Xa;function Gb(a,b,c){this.t=a;this.k=b;this.K=c}q(Gb,s);
Gb.prototype.o=function(a){var b=new N;b.F(this.k.m[0]);b.q(this.k.body.compile(a));var c=new ab;c.ca(this.t.compile(a));c.B(b);a=new O;a.c(1);F(a,2,c);F(a,11,!this.K);c=new E;c.c(2);F(c,4,a);return c};Gb.prototype.a=function(a){return a?"view"===a.shift()?this.t.a(a)+Q(".update("+this.k.a()+")"):Q(this.t.a()+".update(")+this.k.a(a)+" ":this.t.a()+".update("+this.k.a()+")"};function Hb(a,b,c,d,e){this.f=a;this.j=b;this.g=c||"id";this.k=d;this.K=e}q(Hb,s);
Hb.prototype.o=function(a){var b=new N;b.F(this.k.m[0]);b.q(this.k.body.compile(a));var c=new fb;c.r(La(this.f.compile(a)).A());c.I(this.g);c.N(this.j.compile(a));c.B(b);a=new O;a.c(7);F(a,8,c);F(a,11,!this.K);c=new E;c.c(2);F(c,4,a);return c};
Hb.prototype.a=function(a){if(a){var b=a.shift();return b===f?this.f.a(a)+Q(".get("+this.j.a()+", '"+this.g+"').update("+this.k.a()+")"):"key"===b?Q(this.f.a()+".get(")+this.j.a(a)+Q(", '"+this.g+"').update("+this.k.a()+")"):"keyname"===b?Q(this.f.a()+".get("+this.j.a()+", ")+P("'"+this.g+"'")+Q(").update("+this.k.a()+")"):Q(this.f.a()+".get("+this.j.a()+", '"+this.g+"').update(")+this.k.a(a)+" "}return this.f.a()+".get("+this.j.a()+", '"+this.g+"').update("+this.k.a()+")"};
A.prototype.update=function(a,b){y(arguments,1);a=w(a);b=b===f?k:b;return this instanceof Cb?new Hb(this.f,this.j,this.g,a,b):new Gb(this,a,b)};A.prototype.update=A.prototype.update;function Ib(a,b,c){this.t=a;this.k=b;this.K=c}q(Ib,s);Ib.prototype.o=function(a){var b=new N;b.F(this.k.m[0]);b.q(this.k.body.compile(a));var c=new cb;c.ca(this.t.compile(a));c.B(b);a=new O;a.c(3);F(a,4,c);F(a,11,!this.K);c=new E;c.c(2);F(c,4,a);return c};
Ib.prototype.a=function(a){return a?"view"===a.shift()?this.t.a(a)+Q(".mutate("+this.k.a()+")"):Q(this.t.a()+".mutate(")+this.k.a(a)+" ":this.t.a()+".mutate("+this.k.a()+")"};function Jb(a,b,c,d,e){this.f=a;this.j=b;this.g=c||"id";this.k=d;this.K=e}q(Jb,s);Jb.prototype.o=function(a){var b=new N;b.F(this.k.m[0]);b.q(this.k.body.compile(a));var c=new hb;c.r(La(this.f.compile(a)).A());c.I(this.g);c.N(this.j.compile(a));c.B(b);a=new O;a.c(9);F(a,10,c);F(a,11,!this.K);c=new E;c.c(2);F(c,4,a);return c};
Jb.prototype.a=function(a){if(a){var b=a.shift();return b===f?this.f.a(a)+Q(".get("+this.j.a()+", '"+this.g+"').mutate("+this.k.a()+")"):"key"===b?Q(this.f.a()+".get(")+this.j.a(a)+Q(", '"+this.g+"').mutate("+this.k.a()+")"):"keyname"===b?Q(this.f.a()+".get("+this.j.a()+", ")+P("'"+this.g+"'")+Q(").mutate("+this.k.a()+")"):Q(this.f.a()+".get("+this.j.a()+", '"+this.g+"').mutate(")+this.k.a(a)+" "}return this.f.a()+".get("+this.j.a()+", '"+this.g+"').mutate("+this.k.a()+")"};
A.prototype.jb=function(a,b){y(arguments,1);a=w(a);b=b===f?k:b;return this instanceof Cb?new Jb(this.f,this.j,this.g,a,b):new Ib(this,a,b)};A.prototype.mutate=A.prototype.jb;function Kb(){}Kb.prototype.Ea=function(a,b){return 11==a.p||10==a.p?Lb(this,b):b};function Mb(a,b){this.h=a|0;this.d=b|0}var Nb={};function Ob(a){if(-128<=a&&128>a){var b=Nb[a];if(b)return b}b=new Mb(a|0,0>a?-1:0);-128<=a&&128>a&&(Nb[a]=b);return b}function S(a){return isNaN(a)||!isFinite(a)?Pb:a<=-Qb?T:a+1>=Qb?Rb:0>a?U(S(-a)):new Mb(a%Sb|0,a/Sb|0)}function V(a,b){return new Mb(a,b)}var Sb=4294967296,Qb=Sb*Sb/2,Pb=Ob(0),Tb=Ob(1),Ub=Ob(-1),Rb=V(-1,2147483647),T=V(0,-2147483648),Vb=Ob(16777216);l=Mb.prototype;
l.toString=function(a){a=a||10;if(2>a||36<a)throw Error("radix out of range: "+a);if(Wb(this))return"0";if(0>this.d){if(this.n(T)){var b=S(a),c=Xb(this,b),b=Yb(c.multiply(b),this);return c.toString(a)+b.h.toString(a)}return"-"+U(this).toString(a)}for(var c=S(Math.pow(a,6)),b=this,d="";;){var e=Xb(b,c),g=Yb(b,e.multiply(c)).h.toString(a),b=e;if(Wb(b))return g+d;for(;6>g.length;)g="0"+g;d=""+g+d}};function Zb(a){return 0<=a.h?a.h:Sb+a.h}function Wb(a){return 0==a.d&&0==a.h}
l.n=function(a){return this.d==a.d&&this.h==a.h};function $b(a,b){if(a.n(b))return 0;var c=0>a.d,d=0>b.d;return c&&!d?-1:!c&&d?1:0>Yb(a,b).d?-1:1}function U(a){return a.n(T)?T:a.xa().add(Tb)}l.add=function(a){var b=this.d>>>16,c=this.d&65535,d=this.h>>>16,e=a.d>>>16,g=a.d&65535,h=a.h>>>16,m;m=0+((this.h&65535)+(a.h&65535));a=0+(m>>>16);a+=d+h;d=0+(a>>>16);d+=c+g;c=0+(d>>>16);c=c+(b+e)&65535;return V((a&65535)<<16|m&65535,c<<16|d&65535)};function Yb(a,b){return a.add(U(b))}
l.multiply=function(a){if(Wb(this)||Wb(a))return Pb;if(this.n(T))return 1==(a.h&1)?T:Pb;if(a.n(T))return 1==(this.h&1)?T:Pb;if(0>this.d)return 0>a.d?U(this).multiply(U(a)):U(U(this).multiply(a));if(0>a.d)return U(this.multiply(U(a)));if(0>$b(this,Vb)&&0>$b(a,Vb))return S((this.d*Sb+Zb(this))*(a.d*Sb+Zb(a)));var b=this.d>>>16,c=this.d&65535,d=this.h>>>16,e=this.h&65535,g=a.d>>>16,h=a.d&65535,m=a.h>>>16,a=a.h&65535,u,t,B,ca;ca=0+e*a;B=0+(ca>>>16);B+=d*a;t=0+(B>>>16);B=(B&65535)+e*m;t+=B>>>16;B&=65535;
t+=c*a;u=0+(t>>>16);t=(t&65535)+d*m;u+=t>>>16;t&=65535;t+=e*h;u+=t>>>16;t&=65535;u=u+(b*a+c*m+d*h+e*g)&65535;return V(B<<16|ca&65535,u<<16|t)};
function Xb(a,b){if(Wb(b))throw Error("division by zero");if(Wb(a))return Pb;if(a.n(T)){if(b.n(Tb)||b.n(Ub))return T;if(b.n(T))return Tb;var c=Xb(ac(a,1),b).shiftLeft(1);if(c.n(Pb))return 0>b.d?Tb:Ub;var d=Yb(a,b.multiply(c));return c.add(Xb(d,b))}if(b.n(T))return Pb;if(0>a.d)return 0>b.d?Xb(U(a),U(b)):U(Xb(U(a),b));if(0>b.d)return U(Xb(a,U(b)));for(var e=Pb,d=a;0<=$b(d,b);){for(var c=Math.max(1,Math.floor((d.d*Sb+Zb(d))/(b.d*Sb+Zb(b)))),g=Math.ceil(Math.log(c)/Math.LN2),g=48>=g?1:Math.pow(2,g-48),
h=S(c),m=h.multiply(b);0>m.d||0<$b(m,d);)c-=g,h=S(c),m=h.multiply(b);Wb(h)&&(h=Tb);e=e.add(h);d=Yb(d,m)}return e}l.xa=function(){return V(~this.h,~this.d)};l.Ba=function(a){return V(this.h&a.h,this.d&a.d)};l.Ia=function(a){return V(this.h|a.h,this.d|a.d)};function bc(a,b){return V(a.h^b.h,a.d^b.d)}l.shiftLeft=function(a){a&=63;if(0==a)return this;var b=this.h;return 32>a?V(b<<a,this.d<<a|b>>>32-a):V(0,b<<a-32)};
function ac(a,b){b&=63;if(0==b)return a;var c=a.d;return 32>b?V(a.h>>>b|c<<32-b,c>>b):V(c>>b-32,0<=c?0:-1)};function cc(a){for(var b=[],c=0;c<a.length;c++)b.push(String.fromCharCode(a[c]));return b.join("")}function dc(a){return new Uint8Array(Array.prototype.map.call(a,function(a){return a.charCodeAt(0)}))}function ec(){this.u=0}q(ec,Kb);function W(a){throw new ua("Error deserializing incorrectly formated message, "+a);}
function Lb(a,b){for(var c=Ea(b.ka()),d=[],e=0,g=0;g<c.length;g++){var h=c[g];if(Fa(b,h.s)){var m=0;do{var u=a.Ea(h,b.get(h,m));d.push(u);e+=u.byteLength;m++}while(h.Y&&m<Ja(b,h.s))}}c=new Uint8Array(e);for(g=e=0;g<d.length;g++)h=d[g],c.set(new Uint8Array(h),e),e+=h.byteLength;return c}
ec.prototype.Ea=function(a,b){var c=a.p,d=fc[c],e=gc(S(a.s<<3|d)),g;switch(d){case X:var h=S(b);if(c==Aa||17==c)h=bc(h.shiftLeft(1),ac(h,63));g=gc(h);break;case hc:h=new ArrayBuffer(8);c=new DataView(h);switch(a.p){case 1:c.setFloat64(0,b,i);break;case ya:g=S(b);c.setUint32(0,Zb(g),i);c.setUint32(4,g.d,i);break;case za:g=S(b);c.setUint32(0,Zb(g),i);c.setInt32(4,g.d,i);break;default:W("Unexpected field type")}g=new Uint8Array(h);break;case ic:switch(a.p){case 11:h=Lb(this,b);break;case 9:h=dc(unescape(encodeURIComponent(b)));
break;case 12:h=dc(b);break;default:W("Unexpected field type")}g=h.length;c=gc(S(g));g=new Uint8Array(c.length+g);g.set(c,0);g.set(h,c.length);break;case jc:W("Use of Groups deprecated and not supported");break;case kc:h=new ArrayBuffer(4);c=new DataView(h);switch(a.p){case 2:c.setFloat32(0,b,i);break;case 7:c.setUint32(0,b,i);break;case 15:c.setInt32(0,b,i);break;default:W("Unexpected field type")}g=new Uint8Array(h);break;default:W("Unexpected wire type")}h=new Uint8Array(e.length+g.length);h.set(new Uint8Array(e),
0);h.set(new Uint8Array(g),e.length);return h};function gc(a){function b(a){var d=S(128),d=Yb(a,Xb(a,d).multiply(d)).h,e=S(127);0<$b(a,e)?(d+=128,a=b(ac(a,7)),a.unshift(d)):a=[d];return a}a=b(a);return new Uint8Array(a)}
function lc(a,b,c){var d=b.ka();for(a.u=0;a.u<c.length;){var e=mc(a,c),g=d.H[parseInt(e>>3,10)]||j,h=a,m=e%8,u=g,e=c,t=f;switch(m){case X:e=mc(h,e);if(u){h=f;switch(u.p){case wa:case xa:h=e.toString();break;case 5:case 13:case 14:h=e;break;case 17:e=S(e);h=bc(ac(e,1),e.shiftLeft(63)).h;break;case Aa:e=S(e);h=bc(ac(e,1),e.shiftLeft(63)).toString();break;case 8:h=0===h?k:i;break;default:W("Unexpected field type")}t=h}else t=j;break;case ic:m=e;e=mc(h,m);m=new Uint8Array(m.buffer,m.byteOffset+h.u,e);
h.u+=e;if(u){e=f;switch(u.p){case 9:e=decodeURIComponent(escape(cc(m)));break;case 12:e=cc(m);break;case 11:e=m;h=new ec;u=new u.Ha.Q.hb;lc(h,u,e);e=u;break;default:W("Unexpected field type")}t=e}else t=j;break;case kc:e=new DataView(e.buffer,h.u,4);h.u+=4;if(u){h=f;switch(u.p){case 2:h=e.getFloat32(0,i);break;case 7:h=e.getUint32(0,i);break;case 15:h=e.getInt32(0,i);break;default:W("Unexpected field type")}t=h}else t=j;break;case hc:e=new DataView(e.buffer,h.u,8);h.u+=8;if(u){h=f;switch(u.p){case 1:h=
e.getFloat64(0,i);break;case ya:h=(new Mb(e.getUint32(0,i),e.getUint32(4,i))).toString();break;case za:h=(new Mb(e.getUint32(0,i),e.getInt32(4,i))).toString();break;default:W("Unexpected field type")}t=h}else t=j;break;default:W("Unexpected wire type of "+m)}e=t;g!=j&&e!=j&&(g.Y?b.add(g,e):b.set(g,e))}}function mc(a,b){var c=b[a.u++];if(127<c)var c=c-128,d=mc(a,b),c=c+(d<<7);return c}var X=0,hc=1,ic=2,jc=3,kc=5,fc=[-1,hc,kc,X,X,X,hc,kc,X,ic,jc,ic,ic,X,X,kc,hc,X,X];function nc(a){this.name="Runtime Error";this.message=a||"The RDB runtime experienced an error"}q(nc,Error);p("rethinkdb.errors.RuntimeError",nc);function oc(a){this.name="Broken Client";this.message=a||"The client sent the server an incorrectly formatted message"}q(oc,Error);p("rethinkdb.errors.BrokenClient",oc);function pc(a){this.name="Bad Query";this.message=a||"This query contains type errors"}q(pc,Error);p("rethinkdb.errors.BadQuery",pc);
function D(a){this.name="RDB Client Error";this.message=a||"The RDB client has experienced an error"}q(D,Error);p("rethinkdb.errors.ClientError",D);
function rb(a,b,c){var d=Array.prototype.slice.call(arguments,2);return function(c){var g=d.map(function(a){return a instanceof s?a.a():a.toString()}),h=b.a()+"."+a+"("+g.join(", ")+")";if(c){if(0===c.length)return P(h);h=c.shift();"lowerbound"===h?h="arg:1":"upperbound"===h&&(h="arg:2");var m=h.split(":");if("arg"===m[0])return m[1]=parseInt(m[1],10),g=g.map(Q),0===m[1]?h=b.a(c):(h=Q(b.a()),m=m[1]-1,c=d[m].a(c),g[m]=c),g=g.join("  "),h+" "+Q(a)+" "+g+" "}else return h}}
function Q(a){return a.replace(/./g," ")}function P(a){return a.replace(/./g,"^")};function qc(a,b,c){this.sa=a;this.pb=b;this.wb=c;this.Z=[];this.va=k;this.ea=j;this.da=k}qc.prototype.close=function(){delete this.sa.R[this.wb]};qc.prototype.next=function(a){var b=this.Z.shift();b===f?this.va?a(b):(this.ea=fa(this.next,this,a),this.da&&rc(this.sa),this.da=k):a(b)&&this.next(a)};qc.prototype.next=qc.prototype.next;qc.prototype.ra=function(a){this.va?a(this.Z.splice(0,this.Z.length)):(this.ea=fa(this.ra,this,a),this.da&&rc(this.sa),this.da=k)};qc.prototype.collect=qc.prototype.ra;
function sc(a,b,c){n(b)?Array.prototype.push.apply(a.Z,b):a.Z.push(b);a.va=c;a.da=i;a.ea&&a.ea()};function Y(a,b){"undefined"===typeof a?a={}:"string"===typeof a&&(a={host:a});this.la=a.host||this.Sa;this.ma=a.port||this.za;this.z=a.db||this.Ra;x(this.la,"string");x(this.ma,"number");x(this.z,"string");this.R={};this.kb=1;this.ga=b||j;qa=this}Y.prototype.Sa="localhost";Y.prototype.za=12346;Y.prototype.Ra="test";Y.prototype.qb=function(a){this.constructor.call(this,{host:this.la,port:this.ma,db:this.z},a,this.ga)};Y.prototype.reconnect=Y.prototype.qb;
function Z(a,b){if(a.ga)a.ga(b);else if(a.fd)console.log(b.name+":"+b.message);else throw b;}Y.prototype.sb=function(a){this.ga=a};Y.prototype.setErrorHandler=Y.prototype.sb;function tc(a,b){var c=Lb(new ec,b),d=c.byteLength,e=new Uint8Array(d+4);(new DataView(e.buffer)).setInt32(0,d,i);e.set(c,4);a.Ka(e.buffer)}Y.prototype.T=function(a,b){y(arguments,1);var c=a.o({Da:k});c.ya((this.kb++).toString());var d=new qc(this,a,c.M());this.R[c.M()]=d;tc(this,c);b&&d.next(b);return d};Y.prototype.run=Y.prototype.T;
function uc(a,b){(new DataView(b.buffer)).getUint32(0,i)!==b.length-4&&Z(a,new D("RDB response corrupted, length inaccurate"));var c=new ec,d=new lb;try{lc(c,d,new Uint8Array(b.buffer,4))}catch(e){Z(a,new D("response deserialization failed"))}if(c=a.R[d.M()])switch(H(d,1)){case 101:var g=new oc(H(d,4));sc(c,g,i);break;case 103:var g=c.pb,h=H(d,4),d=H(d,5),m=[];d&&(m=Ia(d,1));g=h+"\n\t"+g.a()+"\n\t"+g.a(m);g=new nc(g);sc(c,g,i);break;case 102:g=new pc(H(d,4));sc(c,g,i);break;case 0:delete a.R[d.M()];
sc(c,[],i);break;case 3:delete a.R[d.M()];g=Ia(d,3).map(JSON.parse);sc(c,g,i);break;case 1:delete a.R[d.M()];g=JSON.parse(H(d,3,0));sc(c,g,i);break;case 2:g=Ia(d,3).map(JSON.parse);sc(c,g,k);break;default:g=new D("unknown response status code"),sc(c,g,i)}}Y.prototype.xb=function(a){y(arguments,1);x(a,"string");this.z=a};Y.prototype.use=Y.prototype.xb;Y.prototype.bb=function(){return this.z};Y.prototype.getDefaultDb=Y.prototype.bb;function rc(a){var b=new E;b.c(3);b.ya(f);tc(a,b)};function vc(a,b){this.Na=a;this.w=b||j}q(vc,s);vc.prototype.o=function(){var a=new ib;a.c(this.Na);this.w&&a.ba(this.w);var b=new E;b.c(5);F(b,5,a);return b};vc.prototype.a=function(a){var b=this.w?"'"+this.w+"'":"",c,d="";switch(this.Na){case 1:c="dbCreate";break;case 2:c="dbDrop";break;case 3:c="dbList";break;case 6:c="db",d=".list()"}b="r."+c+"("+b+")";return a?P(b)+Q(d):b+d};p("rethinkdb.dbCreate",function(a){y(arguments,1);x(a,"string");return new vc(1,a)});
p("rethinkdb.dbDrop",function(a){y(arguments,1);x(a,"string");return new vc(2,a)});p("rethinkdb.dbList",function(){return new vc(3)});function $(a){this.v=a}p("rethinkdb.db",function(a){y(arguments,1);x(a,"string");return new $(a)});$.prototype.list=function(){return new vc(6,this.v)};$.prototype.list=$.prototype.list;function wc(a,b,c,d,e){this.X=a;this.w=b;this.J=c;this.g=d;this.W=e}q(wc,s);
wc.prototype.o=function(){var a=new K;a.ba(this.w);F(a,2,this.J);var b=new jb;this.X&&F(b,1,this.X);b.r(a);this.g&&F(b,4,this.g);this.W&&F(b,5,this.W);a=new ib;a.c(4);F(a,3,b);b=new E;b.c(5);F(b,5,a);return b};
wc.prototype.a=function(a){var b;this.X||this.g||this.W?(b=[],this.X&&b.push("dataCenter: '"+this.X+"'"),this.g&&b.push("primaryKey: '"+this.g+"'"),this.W&&b.push("cacheSize: '"+this.W+"'"),this.J&&b.push("tableName: '"+this.J+"'"),b="{"+b.join(", ")+"}"):b="'"+this.J+"'";b="r.db('"+this.w+"').create("+b+")";return a?P(b):b};
$.prototype.create=function(a){y(arguments,1);var b={};"string"===typeof a?b.tableName=a:b=a;x(b.tableName,"string");x(b.primaryKey,"string");x(b.dataCenter,"string");x(b.cacheSize,"string");return new wc(b.dataCenter,this.v,b.tableName,b.primaryKey,b.cacheSize)};$.prototype.create=$.prototype.create;function xc(a,b){y(arguments,1);this.w=a;this.J=b}q(xc,s);xc.prototype.o=function(){var a=new K;a.ba(this.w);F(a,2,this.J);var b=new ib;b.c(5);F(b,4,a);a=new E;a.c(5);F(a,5,b);return a};
xc.prototype.a=function(a){return a?P("r.db('"+this.w+"').drop('"+this.J+"')"):"r.db('"+this.w+"').drop('"+this.J+"')"};$.prototype.$a=function(a){y(arguments,1);x(a,"string");return new xc(this.v,a)};$.prototype.drop=$.prototype.$a;$.prototype.ub=function(a,b){y(arguments,1);x(a,"string");x(b,"boolean");return new C(a,this.v,b)};$.prototype.table=$.prototype.ub;function yc(a,b,c){x(b,"function");x(c,"function");Y.call(this,a,c);this.V="";var d=this,e="http://"+this.la+":"+this.ma+"/ajax/reql/",g=new XMLHttpRequest;g.responseType="arraybuffer";g.open("GET",e+"open-new-connection",i);g.onreadystatechange=function(){4===g.readyState&&(200===g.status?(d.V=e,d.ta=(new DataView(g.response)).getInt32(0,i),b&&b(d)):Z(d,new D("Unabled to establish HTTP connection")))};g.send()}q(yc,Y);p("rethinkdb.HttpConnection",yc);yc.prototype.za=21300;
yc.prototype.Ka=function(a){this.V||Z(this,new D("Connection not open"));var b=new XMLHttpRequest;b.responseType="arraybuffer";b.open("POST",this.V+"?conn_id="+this.ta,i);var c=this;b.onreadystatechange=function(){4===b.readyState&&200===b.status&&uc(c,new Uint8Array(b.response))};b.send(a)};yc.prototype.close=function(){this.V||Z(this,new D("Connection not open"));var a=new XMLHttpRequest;a.open("POST",this.V+"close-connection?conn_id="+this.ta,i);a.send();this.V=this.ta=j};yc.prototype.close=yc.prototype.close;function zc(a,b,c){Ac()||Z(this,new D("Cannot instantiate TcpConnection, TCP sockets are not available in this environment."));x(b,"function");x(c,"function");Y.call(this,a,c);this.S=j;this.gd=0;this.G=j;var d=this;d.G=j;var e=require("net").connect(this.ma,this.la,function(){e.write("35ba61af","hex");e.on("data",fa(d.vb,d));e.on("end",function(){d.G=j;Z(d,new nc("Server disconnected"))});d.G=e;b&&b(d)});e.on("error",function(){Z(d,new D("Unabled to establish TCP connection"))})}q(zc,Y);
p("rethinkdb.TcpConnection",zc);function Ac(){return"undefined"!==typeof require&&require("net")}zc.isAvailable=Ac;zc.prototype.Ka=function(a){this.G||Z(this,new D("Connection not open"));for(var b=new Buffer(a.byteLength),c=new Uint8Array(a),d=0;d<a.byteLength;d++)b[d]=c[d];this.G.write(b)};
zc.prototype.vb=function(a){for(var a=new Uint8Array(a),b=0,c=a.byteLength;0<c;){if(this.S===j){var d=(new DataView(a.buffer,b,c)).getUint32(0,i);this.S=new Uint8Array(d+4);this.$=0}var d=this.S.byteLength-this.$,e=c<d?c:d,g=new Uint8Array(a.buffer,b,e);this.S.set(g,this.$);this.$+=e;b+=e;c-=e;d-=e;0>=d&&(d=this.S,this.S=j,this.$=0,uc(this,d))}};
zc.prototype.close=function(){this.G||Z(this,new D("Connection not open"));var a=this;this.G.removeAllListeners("end");this.G.on("close",function(){a.G=j});this.G.end()};zc.prototype.close=zc.prototype.close;p("rethinkdb.connect",function(a,b,c){return Ac()?new zc(a,b,c):new yc(a,b,c)});var qa=j;p("rethinkdb.getLastConnection",function(){return qa});"undefined"!==typeof exports&&("undefined"!==typeof module&&module.exports?exports=module.exports=aa.rethinkdb:exports.rethinkdb=aa.rethinkdb);
}).call(this);
