
<script id="resolve_issues-container-outer-template" type="text/x-handlebars-template">
  <h1>Resolve issues</h1>
  <div id="user-alert-space"></div>
  <div id="resolve_issues-container-inner-placeholder"></div>
</script>

<script id="resolve_issues-container-inner-template" type="text/x-handlebars-template">
  {{#if issues_exist}}
  <div class="issues"></div>
  {{else}}
  <p class="no-issues">No issues reported in the cluster.</p>
  {{/if}}
</script>

<script id="declare_machine_dead-modal-template" type="text/x-handlebars-template">
    <div class="alert alert-error">
        <h4 class="title_center">Warning</h4>
        <p>If you declare this server dead, you will not be able to reconnect it later, even if it does reconnect, it will consider itself dead and will stop working.</p>
        <p>All the data on the server will be lost.</p>
    </div>
    <div class="alert alert-error error_answer"></div>
    <p>Are you sure you want to declare <strong>{{machine_name}}</strong> dead?</p>
</script>

<script id="fail_solve_issue-template" type="text/x-handlebars-template">
    Sorry, something went wrong. The issue might not be up to date, please refresh.
</script>

<script id="declared_machine_dead-alert-template" type="text/x-handlebars-template">
  <div class="alert" data-alert="alert">
    <a class="close" href="#">&times;</a>
    <p>You successfully declared server <span class="name">{{machine_name}}</span> dead.</p>
  </div>
</script>

<script id="resolve_vclock-modal-template" type="text/x-handlebars-template">
  <div class="alert alert-error error_answer"></div>
  <p>Are you sure you want to use the value <strong>{{final_value}}</strong>?</p>
</script>

<script id="resolved_vclock-alert-template" type="text/x-handlebars-template">
  <div class="alert" data-alert="alert">
    <a class="close" href="#">&times;</a>
    <p>You successfully resolved the configuration value to <span class="name">{{final_value}}</span>.</p>
  </div>
</script>

<script id="resolve_unsatisfiable_goals_modal-template" type="text/x-handlebars-template">
    <div class="alert alert-error error_answer"></div>
    <p>Are you sure you want to lower the number of replicas for the datacenter</p>
    <ul>
    {{#each datacenters_with_issues}}
    <li>
        <a href="#datacenters/{{this.datacenter_id}}">{{this.datacenter_name}}</a> from <strong>{{this.num_replicas}}</strong> to <strong>{{num_machines}}</strong>
        {{#if this.change_ack}}
        <br />Warning: The number of acks will be lowered too.
        {{/if}}
    </li>
    {{/each}}
    <ul>
</script>


<script id="resolved_issues_unsatisfiable_goals-template" type="text/x-handlebars-template">
  <div class="alert" data-alert="alert">
    <a class="close" href="#">&times;</a>
    <p>You successfully solved the unsatisfiable goals issue.</p>
  </div>
</script>


<script id="resolve_issues-machine_down-template" type="text/x-handlebars-template">
  <div class="issue {{#if critical }}critical{{/if}}">
    <div class="header">
      <h3 class="title">Server {{name}} is unreachable.</h3>
      {{#if datetime}}
      <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
      {{/if}}
    </div>
    <hr />
    {{#if no_responsibilities}}
    <h4>This server has no master or replica responsibilities.</h4>

    {{else}}

    <!-- Masters -->
    {{#if masters}}
    <h4>This server is responsible for the following masters:</h4>
    <ul>
      {{#each masters}}
      <li>Namespace <a href="#tables/{{uuid}}">{{name}}</a> for the shard {{shard}}.</li>
      {{/each}}
    </ul>
    {{else}}
    <h4>This server has no master responsibilities.</h4>
    {{/if}}

    <!-- Replicas -->
    {{#if replicas}}
    <h4>This server is responsible for the following replicas:</h4>
    <ul>
      {{#each replicas}}
      <li>Namespace <a href="#tables/{{uuid}}">{{name}}</a> for the shard {{shard}}.</li>
      {{/each}}
    </ul>
    {{else}}
    <h4>This server has no replica responsibilities.</h4>
    {{/if}}

    {{/if}}

    <p><a class="btn large danger">Declare Dead</a></p>
  </div>
</script>
<script id="resolve_issues-name_conflict-template" type="text/x-handlebars-template">
  <div class="issue {{#if critical }}critical{{/if}} name-conflict">
    <div class="header">
      <h3 class="title">The name {{name}} is used by more than one {{type}}.</h3>
      {{#if datetime}}
      <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
      {{/if}}
    </div>
    <hr />
    <h4>{{capitalize type}} with the name {{name}}:</h4>
    <ul>
      {{#each contestants}}
      <li><a href="#{{pluralize_noun type 2}}/{{uuid}}"><span class="uuid">{{humanize_uuid uuid}}</span></a> (<a id="rename_{{uuid}}" href="#">rename</a>)</li>
      {{/each}}
    </ul>
  </div>
</script>
<script id="resolve_issues-logfile_write-template" type="text/x-handlebars-template">
  <div class="issue {{#if critical }}critical{{/if}}">
    <div class="header">
      <h3 class="title">Can't write logs.</h3>
      {{#if datetime}}
      <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
      {{/if}}
    </div>
    <hr />
    <p>Log file is inaccessible on server <a href="/#servers/{{machine_uuid}}">{{machine_name}}</a>. Please resolve the issue on the server, or declare it dead.<p>
    <p><a class="btn large danger">Declare Dead</a></p>
  </div>
</script>
<script id="resolve_issues-vclock_conflict-template" type="text/x-handlebars-template">
  <div class="issue {{#if critical }}critical{{/if}} vclock-conflict">
    <div class="header">
      <h3 class="title">Cluster configuration conflict.</h3>
      {{#if datetime}}
      <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
      {{/if}}
    </div>
    <hr />
    <p>This issue is caused by making changes to the cluster configuration on both sides of an intermittent network connection.</p>
    <h4>{{capitalize field}} of {{object_type}} <a href="">{{#if name_contest}}{{humanize_uuid object_id}}{{else}}{{object_name}}{{/if}}</a> has the following conflicting values:</h4>
    <ul>
      {{#each contestants}}
      <li>{{value}} (<a id="resolve_{{contestant_id}}" href="#">use this value</a>)</li>
      {{/each}}
    </ul>
  </div>
</script>

<script id="resolve_issues-unsatisfiable_goals-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <div class="header">
            <h3 class="title">Unsatisfiable goals</h3>
            {{#if datetime}}
            <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
        {{/if}}
        </div>
        <hr />
        <h4>The goals you have specified are impossible for the table <a href="#tables/{{namespace_id}}">{{namespace_name}}</a></h4>
        {{#if no_primary}}You have to <a href="#tables/{{namespace_id}}/replication">choose</a> a primary datacenter to make this table works.{{/if}}
        {{#each datacenters_with_issues}}
        <p class="description">You require {{this.num_replicas}} {{pluralize_noun "replica" this.num_replicas}} for the datacenter <a href="#datacenters/{{this.datacenter_id}}">{{this.datacenter_name}}</a> but you only have {{num_machines}} {{pluralize_noun "server" this.num_machines}} available.</p>
        {{/each}}
        {{#if datacenters_with_issues}}
        <p class="description">To solve this issue, you can lower the number of replicas or connect a new server to the datacenter.</p>

        <p><a class="btn large danger solve_unsatisfiable_goals">Lower the number of replicas</a></p>
        {{/if}}

  </div>
</script>



<script id="resolve_issues-machine_ghost-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <div class="header">
            <h3 class="title">Zombie server</h3>
            {{#if datetime}}
            <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
        {{/if}}
        </div>
        <hr />
        <h4>A server was declared dead, but is now connected to the cluster.</h4>
        <p class="description">Server's id: <a href="#servers/{{machine_id}}">{{machine_name}}</a><br/>
        Please manually remove it (by killing the rethinkDB instance for example)</p>
  </div>
</script>

<script id="resolve_issues-port_conflict-template" type="text/x-handlebars-template">
    <div class="issue {{#if critical }}critical{{/if}}">
        <div class="header">
            <h3 class="title">Could not bind to port</h3>
            {{#if datetime}}
            <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
            {{/if}}
        </div>
        <hr />
        <h4>A necessary port is already in use on this server</h4>
        <p class="description">Server <a href="#servers/{{machine_id}}">{{machine_name}}</a> {{description}}.<br/>
        Some other process is likely using this port. Kill it or instruct it to release the port in order to resolve this issue.</p>
    </div>
</script>


<script id="resolve_issues-unknown-template" type="text/x-handlebars-template">
  <div class="issue {{#if critical }}critical{{/if}}">
    <div class="header">
      <h3 class="title">Unknown issue: {{issue_type}}</h3>
      {{#if datetime}}
      <p class="datetime"><abbr class="timeago" title="{{datetime}}">on {{prettify_date datetime}}</abbr></p>
      {{/if}}
    </div>
    <hr />
    <h4>Whoops, this shouldn't happen. Please contact support and hope for the best.</h4>
  </div>
</script>

