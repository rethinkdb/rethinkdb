name: Test base
description: Base action for running steps

inputs:
  command:
    description: The test runner command to execute.
    required: true
  download_artifacts:
    description: Download and decompress build artifacts.
    default: "true"
    required: false

# Composite step for using the test runner with multiple parameters.
runs:
  using: composite
  steps:
    - uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: install prerequisites
      shell: bash
      run: |
        sudo apt update && sudo apt install -y curl make git ca-certificates gnupg2 python3-pip python3-dev
        pip install --upgrade pip setuptools wheel

    - name: download build artifacts
      uses: actions/download-artifact@v4
      if: ${{ inputs.download_artifacts == 'true' }}
      with:
        name: build-artifacts

    - name: decompress build dir
      if: ${{ inputs.download_artifacts == 'true' }}
      shell: bash
      run: tar -xzf build.tar.gz

    - name: run tests
      shell: bash
      run: ${{ inputs.command }}
