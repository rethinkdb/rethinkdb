#!/usr/bin/env ruby

# The ruby driver does not use protocol buffers any more, but
# it uses the constants from the proto file.
#
# This script strips protobuf-related declarations and
# wraps the file in the RethinkDB module

puts "# DO NOT EDIT"
puts "# Autogenerated by strip-protofile"
puts "module RethinkDB"
level = 1
ARGF.each do |line|
	if (line =~ /^\s*message (\w+) \{/ || line =~ /^\s+enum (\w+) \{/)
		puts "  " * level + "module #{$1}"
		level += 1
	elsif line =~ /^\s+(\w+)\s+=\s+(\w+);/
		puts "  " * level + "#{$1} = #{$2}"
	elsif line =~ /^\s*\}/
		level -= 1
		puts "  " * level + "end"
	end
end
puts "end"
